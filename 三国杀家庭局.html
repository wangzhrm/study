<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å›½æ€ä¸‰äººå±€ç§¯åˆ†ç³»ç»Ÿ - æé€Ÿç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* æ ¸å¿ƒæ ·å¼è¡¥å…¨ä¸ä¼˜åŒ– */
        :root {
            --zhugong: linear-gradient(135deg, #d4af37, #8b0000);
            --neijian: linear-gradient(135deg, #4b0082, #1a2a6c);
            --fanzei: linear-gradient(135deg, #8b0000, #310000);
            --zhongchen: linear-gradient(135deg, #0d6b1a, #05330a);
        }

        body {
            background: radial-gradient(circle at center, #2c3e50 0%, #000 100%);
            color: #fff;
            font-family: 'STKaiti', 'Microsoft YaHei', serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container { max-width: 1200px; width: 100%; text-align: center; }

        /* å¡ç‰‡å®¹å™¨ */
        .cards-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            perspective: 2000px;
            margin: 40px 0;
        }

        .card-wrapper { width: 220px; height: 320px; cursor: pointer; }

        .card {
            width: 100%; height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card.flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            border: 3px solid #ffd700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .card-back {
            background: #1a5e20 url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        .card-back.selected {
            background: #1a237e; /* å·²è¢«é€‰èµ°å˜ä¸ºè“è‰² */
            border-color: #5c6bc0;
        }

        .card-front { transform: rotateY(180deg); }
        .card-front.zhugong { background: var(--zhugong); }
        .card-front.neijian { background: var(--neijian); }
        .card-front.fanzei { background: var(--fanzei); }
        .card-front.zhongchen { background: var(--zhongchen); }

        /* çŠ¶æ€æ  */
        .status-bar {
            background: rgba(0,0,0,0.6);
            padding: 15px 40px;
            border-radius: 50px;
            border: 1px solid #ffd700;
            margin: 20px 0;
            font-size: 1.2rem;
            color: #ffd700;
        }

        /* ç§¯åˆ†æ¦œä¸ç»Ÿè®¡ */
        .stats-panel {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.8);
            border: 1px solid #ffd700;
            padding: 20px;
            border-radius: 10px;
            width: 200px;
            text-align: left;
        }

        .score-item { display: flex; justify-content: space-between; margin: 10px 0; border-bottom: 1px solid #333; }

        .btn {
            background: #ffd700; color: #000;
            border: none; padding: 12px 30px;
            border-radius: 25px; font-weight: bold;
            cursor: pointer; margin: 10px;
            transition: 0.3s;
        }

        .btn:hover { transform: scale(1.1); background: #ffea00; }
    </style>
</head>
<body>

    <div class="stats-panel" id="statsPanel">
        <h3 style="color:#ffd700">å®æ—¶ç§¯åˆ†æ¦œ</h3>
        <div id="scoreBoard"></div>
        <hr style="margin:15px 0; border-color:#333">
        <h3 style="color:#ffd700">è§’è‰²åˆ†é…</h3>
        <div id="roleStats" style="font-size: 0.8rem"></div>
    </div>

    <div class="container">
        <h1>ä¸‰å›½æ€ Â· æˆ˜ç•¥ç§¯åˆ†ç³»ç»Ÿ</h1>
        <div class="status-bar" id="status">æ­£åœ¨å‡†å¤‡æˆ˜åœº...</div>

        <div class="cards-container" id="cardsContainer">
            </div>

        <div id="gameControls">
            <button class="btn" onclick="revealAll()" id="endBtn" style="display:none">ç»“ç®—æœ¬å±€</button>
            <button class="btn" onclick="startNewRound()" id="nextBtn" style="display:none">å¼€å¯ä¸‹ä¸€å±€</button>
        </div>

        <div id="winnerSelect" style="display:none; margin-top: 20px;">
            <h3 style="color:#ffd700">è°èµ¢äº†ï¼Ÿ</h3>
            <div id="winnerBtns"></div>
        </div>
    </div>

    <div id="initModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; justify-content:center; align-items:center; z-index:100;">
        <div style="background:#222; padding:40px; border-radius:20px; border:2px solid #ffd700; text-align:center">
            <h2>è®¾ç½®å‚èµ›æ­¦å°†</h2>
            <div style="margin:20px 0">
                <input type="text" id="p1" value="ç‘ç‘" style="padding:10px; margin:5px"><br>
                <input type="text" id="p2" value="å¦ˆå¦ˆ" style="padding:10px; margin:5px"><br>
                <input type="text" id="p3" value="çˆ¸çˆ¸" style="padding:10px; margin:5px">
            </div>
            <button class="btn" onclick="setupGame()">è¿›å…¥æˆ˜åœº</button>
        </div>
    </div>

<script>
    let players = [];
    let scores = {};
    let roleHistory = {};
    let currentRoles = [];
    let assignments = {};
    let currentPlayerIdx = 0;
    let selectedCount = 0;

    const ROLES_POOL = [
        ['ä¸»å…¬', 'åè´¼', 'å†…å¥¸'],
        ['ä¸»å…¬', 'åè´¼', 'åè´¼'],
        ['ä¸»å…¬', 'å¿ è‡£', 'åè´¼']
    ];

    function setupGame() {
        players = [
            document.getElementById('p1').value,
            document.getElementById('p2').value,
            document.getElementById('p3').value
        ];
        players.forEach(p => {
            scores[p] = 0;
            roleHistory[p] = { 'ä¸»å…¬': 0, 'å†…å¥¸': 0, 'åè´¼': 0, 'å¿ è‡£': 0 };
        });
        document.getElementById('initModal').style.display = 'none';
        updateStats();
        startNewRound();
    }

    function startNewRound() {
        currentPlayerIdx = 0;
        selectedCount = 0;
        assignments = {};
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('winnerSelect').style.display = 'none';
        document.getElementById('endBtn').style.display = 'none';

        // éšæœºé€‰æ‹©å±€åŠ¿é…ç½®
        let config = ROLES_POOL[Math.floor(Math.random() * ROLES_POOL.length)];
        currentRoles = [...config].sort(() => Math.random() - 0.5);

        renderCards();
        updateStatus();
    }

    function renderCards() {
        const container = document.getElementById('cardsContainer');
        container.innerHTML = '';
        currentRoles.forEach((role, idx) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'card-wrapper';
            wrapper.innerHTML = `
                <div class="card" id="card-${idx}" onclick="handleCardAction(${idx})">
                    <div class="card-face card-back">
                        <span id="label-${idx}" style="font-size:0.8rem">ç‚¹å‡»æŸ¥çœ‹èº«ä»½</span>
                    </div>
                    <div class="card-face card-front ${getRoleClass(role)}">
                        <div style="font-size:3rem">${getRoleIcon(role)}</div>
                        <h2>${role}</h2>
                    </div>
                </div>
            `;
            container.appendChild(wrapper);
        });
    }

    function handleCardAction(idx) {
        if (selectedCount >= 3) return;
        
        const card = document.getElementById(`card-${idx}`);
        const label = document.getElementById(`label-${idx}`);
        const currentPlayer = players[currentPlayerIdx];

        // ç¬¬ä¸€æ­¥ï¼šç¿»å¼€æŸ¥çœ‹
        if (!card.classList.contains('flipped') && !card.querySelector('.card-back').classList.contains('selected')) {
            card.classList.add('flipped');
            document.getElementById('status').innerText = `${currentPlayer} æ­£åœ¨æŸ¥çœ‹... (å†æ¬¡ç‚¹å‡»ç¡®è®¤)`;
        } 
        // ç¬¬äºŒæ­¥ï¼šç¡®è®¤å¹¶é”å®š
        else if (card.classList.contains('flipped')) {
            card.classList.remove('flipped');
            card.querySelector('.card-back').classList.add('selected');
            label.innerText = `ç©å®¶ï¼š${currentPlayer}`;
            
            assignments[currentPlayer] = currentRoles[idx];
            roleHistory[currentPlayer][currentRoles[idx]]++;
            
            selectedCount++;
            currentPlayerIdx++;
            
            if (selectedCount < 3) {
                updateStatus();
            } else {
                document.getElementById('status').innerText = "æ‰€æœ‰æ­¦å°†å°±ä½ï¼Œè¯·å¼€å§‹å®æ€ï¼";
                document.getElementById('endBtn').style.display = 'inline-block';
            }
        }
    }

    function revealAll() {
        document.querySelectorAll('.card').forEach(c => c.classList.add('flipped'));
        document.getElementById('endBtn').style.display = 'none';
        showWinnerOptions();
    }

    function showWinnerOptions() {
        const panel = document.getElementById('winnerSelect');
        const btnArea = document.getElementById('winnerBtns');
        panel.style.display = 'block';
        btnArea.innerHTML = '';

        // æå–æœ¬å±€å‡ºç°çš„å”¯ä¸€èº«ä»½ä½œä¸ºè·èƒœé€‰é¡¹
        const activeRoles = [...new Set(Object.values(assignments))];
        activeRoles.forEach(role => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerText = `${role} è·èƒœ`;
            btn.onclick = () => calculateScores(role);
            btnArea.appendChild(btn);
        });
    }

    function calculateScores(winnerRole) {
        players.forEach(p => {
            const pRole = assignments[p];
            if (pRole === winnerRole) {
                scores[p] += (winnerRole === 'å†…å¥¸' ? 3 : 2); // å†…å¥¸è·èƒœåŠ 3åˆ†ï¼Œå…¶ä½™2åˆ†
            }
        });
        updateStats();
        document.getElementById('winnerSelect').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'inline-block';
    }

    function updateStats() {
        const board = document.getElementById('scoreBoard');
        board.innerHTML = players.map(p => `
            <div class="score-item">
                <span>${p}</span>
                <span style="color:#ffd700">${scores[p]}</span>
            </div>
        `).join('');

        const roles = document.getElementById('roleStats');
        roles.innerHTML = players.map(p => `
            <div style="margin-bottom:8px">
                <b>${p}:</b><br>
                ä¸»(${roleHistory[p]['ä¸»å…¬']}) å†…(${roleHistory[p]['å†…å¥¸']}) å(${roleHistory[p]['åè´¼']})
            </div>
        `).join('');
    }

    function updateStatus() {
        document.getElementById('status').innerText = `è¯· [ ${players[currentPlayerIdx]} ] æŠ½å–èº«ä»½ç‰Œ`;
    }

    function getRoleClass(role) {
        if (role === 'ä¸»å…¬') return 'zhugong';
        if (role === 'å†…å¥¸') return 'neijian';
        if (role === 'åè´¼') return 'fanzei';
        return 'zhongchen';
    }

    function getRoleIcon(role) {
        const icons = { 'ä¸»å…¬': 'ğŸ‘‘', 'å†…å¥¸': 'ğŸ­', 'åè´¼': 'âš”ï¸', 'å¿ è‡£': 'ğŸ›¡ï¸' };
        return icons[role] || 'ğŸ‘¤';
    }
</script>
</body>
</html>
