<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汉语词汇学习系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #2c3e50;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #3498db, #2c3e50);
            color: white;
            text-align: center;
            padding: 30px 20px;
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            padding: 5px 0;
        }
        
        .mode-btn {
            padding: 18px 40px;
            font-size: 1.2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #555;
            position: relative;
        }
        
        .mode-btn.active {
            color: #2c3e50;
            background: white;
        }
        
        .mode-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: #3498db;
        }
        
        .mode-btn:hover:not(.active) {
            background: #eef2f7;
            color: #2c3e50;
        }
        
        .content-area {
            padding: 30px;
            min-height: 500px;
        }
        
        .unit-selection {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 2.2rem;
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: #3498db;
            border-radius: 2px;
        }
        
        .unit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .unit-card {
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .unit-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #3498db;
            background: linear-gradient(to bottom, #e9ecef, #dae0e5);
        }
        
        .unit-card.active {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border-color: #2980b9;
        }
        
        .unit-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .unit-card.active i {
            color: white;
        }
        
        .unit-card h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .unit-card p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .study-content {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.05);
        }
        
        .vocab-section {
            margin-bottom: 35px;
        }
        
        .vocab-section h3 {
            font-size: 1.6rem;
            color: #2980b9;
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 4px solid #3498db;
        }
        
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .vocab-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            border: 1px solid #eaeaea;
        }
        
        .vocab-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border-color: #3498db;
        }
        
        .chinese {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .pinyin {
            font-size: 1.4rem;
            text-align: center;
            color: #e74c3c;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .meaning {
            font-size: 1rem;
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .quiz-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 35px 0;
        }
        
        .quiz-type-btn {
            padding: 20px 40px;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            width: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-type-btn i {
            font-size: 2.5rem;
            color: #3498db;
        }
        
        .quiz-type-btn:hover {
            background: linear-gradient(to bottom, #e9ecef, #dae0e5);
            border-color: #3498db;
            transform: translateY(-5px);
        }
        
        .quiz-type-btn.active {
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
            color: white;
            border-color: #27ae60;
        }
        
        .quiz-type-btn.active i {
            color: white;
        }
        
        .question-area {
            text-align: center;
            padding: 40px 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        .question-text {
            font-size: 3rem;
            margin: 40px 0;
            font-weight: bold;
            color: #2c3e50;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .handwriting-prompt {
            background: white;
            border: 2px dashed #3498db;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        
        .handwriting-prompt i {
            font-size: 4rem;
            color: #3498db;
            margin-bottom: 20px;
        }
        
        .handwriting-prompt h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .handwriting-prompt p {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .progress-container {
            margin: 30px 0;
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #2ecc71, #3498db);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .nav-btn {
            padding: 15px 35px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn i {
            font-size: 1.2rem;
        }
        
        .next-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .next-btn:hover {
            background: linear-gradient(to right, #27ae60, #219653);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }
        
        .back-btn {
            background: linear-gradient(to right, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .back-btn:hover {
            background: linear-gradient(to right, #7f8c8d, #6c7a89);
            transform: translateY(-3px);
        }
        
        .results-container {
            padding: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #3498db;
        }
        
        .result-card .chinese {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .result-card .pinyin {
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        
        .hidden {
            display: none;
        }
        
        .summary-box {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 30px auto;
            max-width: 600px;
        }
        
        .summary-box h2 {
            color: white;
            margin-bottom: 20px;
        }
        
        .summary-box h2::after {
            background: white;
        }
        
        .instructions {
            background: #e3f2fd;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            border-left: 4px solid #3498db;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 25px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        @media (max-width: 768px) {
            .unit-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .quiz-options {
                flex-direction: column;
                align-items: center;
            }
            
            .quiz-type-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .question-text {
                font-size: 2.2rem;
            }
            
            .vocab-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>汉语词汇学习系统</h1>
            <div class="subtitle">拼音、词汇、成语学习与自测工具 - 在纸上作答，最后核对答案</div>
        </header>
        
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="study">
                <i class="fas fa-book"></i> 学习模式
            </button>
            <button class="mode-btn" data-mode="quiz">
                <i class="fas fa-pencil-alt"></i> 测试模式
            </button>
        </div>
        
        <div class="content-area">
            <!-- Unit Selection -->
            <div id="unit-selection-section">
                <h2><i class="fas fa-layer-group"></i> 选择学习单元</h2>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                    <ul>
                        <li>选择您想要学习或测试的单元</li>
                        <li>在学习模式中，您可以查看所有词汇及其拼音</li>
                        <li>在测试模式中，您可以选择听写测试或拼音测试</li>
                        <li>测试时请在纸上作答，完成后查看正确答案</li>
                    </ul>
                </div>
                
                <div class="unit-grid" id="unit-buttons">
                    <!-- Unit buttons will be generated here -->
                </div>
            </div>
            
            <!-- Study Mode Content -->
            <div id="study-mode-section" class="hidden">
                <div class="study-content" id="study-content">
                    <!-- Vocabulary content will be loaded here -->
                </div>
                <div class="btn-container">
                    <button class="nav-btn back-btn" id="back-to-units">
                        <i class="fas fa-arrow-left"></i> 返回单元选择
                    </button>
                </div>
            </div>
            
            <!-- Quiz Mode Content -->
            <div id="quiz-mode-section" class="hidden">
                <h2><i class="fas fa-tasks"></i> 选择测试类型</h2>
                
                <div class="quiz-options">
                    <button class="quiz-type-btn" data-type="dictation">
                        <i class="fas fa-headphones"></i>
                        <span>听写测试</span>
                        <small>根据拼音写出词语</small>
                    </button>
                    <button class="quiz-type-btn" data-type="pronunciation">
                        <i class="fas fa-volume-up"></i>
                        <span>拼音测试</span>
                        <small>根据词语写出拼音</small>
                    </button>
                </div>
                
                <div class="btn-container">
                    <button class="nav-btn back-btn" id="back-to-units-quiz">
                        <i class="fas fa-arrow-left"></i> 返回单元选择
                    </button>
                </div>
                
                <div id="quiz-area" class="hidden">
                    <div class="progress-container">
                        <div class="progress-bar" id="quiz-progress"></div>
                        <div class="progress-text">进度: <span id="current-progress">0</span>/<span id="total-questions">0</span></div>
                    </div>
                    
                    <div class="question-area">
                        <div class="question-text" id="question-text"></div>
                        
                        <div class="handwriting-prompt">
                            <i class="fas fa-pencil-alt"></i>
                            <h3>请在纸上作答</h3>
                            <p>根据题目在您的练习本上写出答案，完成后再点击"下一题"按钮继续</p>
                        </div>
                    </div>
                    
                    <div class="btn-container">
                        <button class="nav-btn next-btn" id="next-question">
                            <i class="fas fa-arrow-right"></i> 下一题
                        </button>
                    </div>
                </div>
                
                <div id="results-section" class="hidden">
                    <div class="summary-box">
                        <h2><i class="fas fa-check-circle"></i> 测试完成!</h2>
                        <p>以下是本单元所有测试题目的正确答案，请与您在纸上写的答案进行核对</p>
                    </div>
                    
                    <div class="results-grid" id="results-container">
                        <!-- Results will be displayed here -->
                    </div>
                    
                    <div class="btn-container">
                        <button class="nav-btn back-btn" id="back-to-quiz">
                            <i class="fas fa-arrow-left"></i> 返回测试
                        </button>
                        <button class="nav-btn next-btn" id="restart-quiz">
                            <i class="fas fa-redo"></i> 重新测试
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vocabulary Data
        const vocabularyData = {
            "1": {
                name: "自然奇观",
                words: [
                    { word: "奇观", pinyin: "qí guān", meaning: "spectacular sight" },
                    { word: "农历", pinyin: "nóng lì", meaning: "lunar calendar" },
                    { word: "据说", pinyin: "jù shuō", meaning: "it is said" },
                    { word: "宽阔", pinyin: "kuān kuò", meaning: "wide, broad" },
                    { word: "人山人海", pinyin: "rén shān rén hǎi", meaning: "huge crowds of people" },
                    { word: "感动", pinyin: "gǎn dòng", meaning: "to be moved/touched" }
                ],
                idioms: [
                    { word: "若隐若现", pinyin: "ruò yǐn ruò xiàn", meaning: "appear indistinctly" },
                    { word: "人声鼎沸", pinyin: "rén shēng dǐng fèi", meaning: "bustling with noise" },
                    { word: "风平浪静", pinyin: "fēng píng làng jìng", meaning: "calm and tranquil" },
                    { word: "水天相接", pinyin: "shuǐ tiān xiāng jiē", meaning: "water and sky merge" }
                ]
            },
            "2": {
                name: "乡村生活",
                words: [
                    { word: "柔和", pinyin: "róu hé", meaning: "soft, gentle" },
                    { word: "鹅卵石", pinyin: "é luǎn shí", meaning: "cobblestone" },
                    { word: "河床", pinyin: "hé chuáng", meaning: "riverbed" },
                    { word: "新鲜", pinyin: "xīn xiān", meaning: "fresh" },
                    { word: "修补", pinyin: "xiū bǔ", meaning: "to repair" },
                    { word: "庄稼", pinyin: "zhuāng jia", meaning: "crops" }
                ],
                idioms: [
                    { word: "弯弯曲曲", pinyin: "wān wān qū qū", meaning: "winding, meandering" },
                    { word: "归根到底", pinyin: "guī gēn dào dǐ", meaning: "in the final analysis" }
                ]
            },
            "3": {
                name: "植物世界",
                words: [
                    { word: "豌豆", pinyin: "wān dòu", meaning: "pea" },
                    { word: "按照", pinyin: "àn zhào", meaning: "according to" },
                    { word: "暖洋洋", pinyin: "nuǎn yáng yáng", meaning: "warm and cozy" },
                    { word: "舒适", pinyin: "shū shì", meaning: "comfortable" },
                    { word: "黑暗", pinyin: "hēi àn", meaning: "dark" }
                ],
                idioms: []
            },
            "4": {
                name: "科技探索",
                words: [
                    { word: "蚊子", pinyin: "wén zi", meaning: "mosquito" },
                    { word: "即使", pinyin: "jí shǐ", meaning: "even if" },
                    { word: "灵巧", pinyin: "líng qiǎo", meaning: "dexterous" },
                    { word: "科学家", pinyin: "kē xué jiā", meaning: "scientist" },
                    { word: "横七竖八", pinyin: "héng qī shù bā", meaning: "in disorder" }
                ],
                idioms: []
            },
            "5": {
                name: "现代科技",
                words: [
                    { word: "呼风唤雨", pinyin: "hū fēng huàn yǔ", meaning: "summon wind and rain" },
                    { word: "世纪", pinyin: "shì jì", meaning: "century" },
                    { word: "技术", pinyin: "jì shù", meaning: "technology" },
                    { word: "改变", pinyin: "gǎi biàn", meaning: "to change" },
                    { word: "程度", pinyin: "chéng dù", meaning: "degree, extent" }
                ],
                idioms: [
                    { word: "出乎意料", pinyin: "chū hū yì liào", meaning: "unexpected" }
                ]
            },
            "6": {
                name: "成语集锦",
                words: [],
                idioms: [
                    { word: "精卫填海", pinyin: "jīng wèi tián hǎi", meaning: "dogged determination" },
                    { word: "气急败坏", pinyin: "qì jí bài huài", meaning: "flustered and exasperated" },
                    { word: "女娲补天", pinyin: "nǚ wā bǔ tiān", meaning: "repair the sky" },
                    { word: "欢声笑语", pinyin: "huān shēng xiào yǔ", meaning: "cheerful talking and laughing" }
                ]
            }
        };

        // DOM Elements
        const modeButtons = document.querySelectorAll('.mode-btn');
        const unitSelectionSection = document.getElementById('unit-selection-section');
        const studyModeSection = document.getElementById('study-mode-section');
        const quizModeSection = document.getElementById('quiz-mode-section');
        const unitButtonsContainer = document.getElementById('unit-buttons');
        const studyContent = document.getElementById('study-content');
        const backToUnitsBtn = document.getElementById('back-to-units');
        const backToUnitsQuizBtn = document.getElementById('back-to-units-quiz');
        const quizTypeButtons = document.querySelectorAll('.quiz-type-btn');
        const quizArea = document.getElementById('quiz-area');
        const questionText = document.getElementById('question-text');
        const quizProgress = document.getElementById('quiz-progress');
        const currentProgress = document.getElementById('current-progress');
        const totalQuestions = document.getElementById('total-questions');
        const nextQuestionBtn = document.getElementById('next-question');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('results-container');
        const backToQuizBtn = document.getElementById('back-to-quiz');
        const restartQuizBtn = document.getElementById('restart-quiz');

        // State variables
        let currentMode = 'study';
        let currentUnit = null;
        let quizType = null;
        let quizQuestions = [];
        let currentQuestionIndex = 0;

        // Initialize the page
        function initPage() {
            generateUnitButtons();
            addEventListeners();
        }

        // Generate unit selection buttons
        function generateUnitButtons() {
            unitButtonsContainer.innerHTML = '';
            
            for (const unitId in vocabularyData) {
                const unitData = vocabularyData[unitId];
                const wordCount = unitData.words.length + unitData.idioms.length;
                
                const card = document.createElement('div');
                card.className = 'unit-card';
                card.innerHTML = `
                    <i class="fas fa-book-open"></i>
                    <h3>单元 ${unitId}</h3>
                    <p>${unitData.name}</p>
                    <small>${wordCount} 个词汇</small>
                `;
                card.dataset.unit = unitId;
                unitButtonsContainer.appendChild(card);
            }
        }

        // Add event listeners
        function addEventListeners() {
            // Mode selection
            modeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    setMode(button.dataset.mode);
                });
            });
            
            // Unit selection
            unitButtonsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.unit-card');
                if (card) {
                    selectUnit(card.dataset.unit);
                }
            });
            
            // Back to unit selection (study mode)
            backToUnitsBtn.addEventListener('click', () => {
                studyModeSection.classList.add('hidden');
                unitSelectionSection.classList.remove('hidden');
                currentUnit = null;
            });
            
            // Back to unit selection (quiz mode)
            backToUnitsQuizBtn.addEventListener('click', () => {
                quizModeSection.classList.add('hidden');
                quizArea.classList.add('hidden');
                resultsSection.classList.add('hidden');
                unitSelectionSection.classList.remove('hidden');
                currentUnit = null;
                quizType = null;
            });
            
            // Quiz type selection
            quizTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    setQuizType(button.dataset.type);
                });
            });
            
            // Quiz navigation
            nextQuestionBtn.addEventListener('click', showNextQuestion);
            
            // Results navigation
            backToQuizBtn.addEventListener('click', () => {
                resultsSection.classList.add('hidden');
                quizArea.classList.remove('hidden');
            });
            
            restartQuizBtn.addEventListener('click', () => {
                resultsSection.classList.add('hidden');
                startQuiz();
            });
        }

        // Set current mode
        function setMode(mode) {
            currentMode = mode;
            
            // Update UI
            modeButtons.forEach(button => {
                if (button.dataset.mode === mode) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Show appropriate sections
            unitSelectionSection.classList.remove('hidden');
            studyModeSection.classList.add('hidden');
            quizModeSection.classList.add('hidden');
            quizArea.classList.add('hidden');
            resultsSection.classList.add('hidden');
            
            if (mode === 'quiz') {
                quizModeSection.classList.remove('hidden');
            }
        }

        // Select a unit
        function selectUnit(unitId) {
            currentUnit = unitId;
            
            // Highlight selected unit card
            document.querySelectorAll('.unit-card').forEach(card => {
                if (card.dataset.unit === unitId) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            if (currentMode === 'study') {
                showStudyContent(unitId);
            } else if (currentMode === 'quiz' && quizType) {
                startQuiz();
            }
        }

        // Show study content for a unit
        function showStudyContent(unitId) {
            const unitData = vocabularyData[unitId];
            
            // Hide unit selection, show study content
            unitSelectionSection.classList.add('hidden');
            studyModeSection.classList.remove('hidden');
            
            // Clear previous content
            studyContent.innerHTML = '';
            
            // Add words
            if (unitData.words.length > 0) {
                const wordsSection = document.createElement('div');
                wordsSection.className = 'vocab-section';
                wordsSection.innerHTML = '<h3><i class="fas fa-font"></i> 词语</h3>';
                
                const wordsGrid = document.createElement('div');
                wordsGrid.className = 'vocab-grid';
                
                unitData.words.forEach(item => {
                    const vocabCard = document.createElement('div');
                    vocabCard.className = 'vocab-card';
                    vocabCard.innerHTML = `
                        <div class="chinese">${item.word}</div>
                        <div class="pinyin">${item.pinyin}</div>
                        <div class="meaning">${item.meaning}</div>
                    `;
                    wordsGrid.appendChild(vocabCard);
                });
                
                wordsSection.appendChild(wordsGrid);
                studyContent.appendChild(wordsSection);
            }
            
            // Add idioms
            if (unitData.idioms.length > 0) {
                const idiomsSection = document.createElement('div');
                idiomsSection.className = 'vocab-section';
                idiomsSection.innerHTML = '<h3><i class="fas fa-quote-right"></i> 成语</h3>';
                
                const idiomsGrid = document.createElement('div');
                idiomsGrid.className = 'vocab-grid';
                
                unitData.idioms.forEach(item => {
                    const vocabCard = document.createElement('div');
                    vocabCard.className = 'vocab-card';
                    vocabCard.innerHTML = `
                        <div class="chinese">${item.word}</div>
                        <div class="pinyin">${item.pinyin}</div>
                        <div class="meaning">${item.meaning}</div>
                    `;
                    idiomsGrid.appendChild(vocabCard);
                });
                
                idiomsSection.appendChild(idiomsGrid);
                studyContent.appendChild(idiomsSection);
            }
        }

        // Set quiz type
        function setQuizType(type) {
            quizType = type;
            
            // Update UI
            quizTypeButtons.forEach(button => {
                if (button.dataset.type === type) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Start quiz if unit is already selected
            if (currentUnit) {
                startQuiz();
            }
        }

        // Start a quiz
        function startQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            
            // Generate quiz questions
            quizQuestions = generateQuizQuestions();
            
            if (quizQuestions.length === 0) {
                alert('该单元没有可测试的内容！');
                return;
            }
            
            // Hide results, show quiz area
            resultsSection.classList.add('hidden');
            quizArea.classList.remove('hidden');
            
            // Update total questions display
            totalQuestions.textContent = quizQuestions.length;
            
            // Show first question
            showQuestion();
        }

        // Generate quiz questions based on unit and quiz type
        function generateQuizQuestions() {
            const questions = [];
            const unitData = vocabularyData[currentUnit];
            
            // Combine words and idioms
            const allItems = [...unitData.words, ...unitData.idioms];
            
            // Create questions based on quiz type
            if (quizType === 'dictation') {
                // Dictation mode: show pinyin, ask for word
                allItems.forEach(item => {
                    questions.push({
                        type: 'dictation',
                        question: item.pinyin,
                        answer: item.word,
                        pinyin: item.pinyin,
                        meaning: item.meaning
                    });
                });
            } else if (quizType === 'pronunciation') {
                // Pronunciation mode: show word, ask for pinyin
                allItems.forEach(item => {
                    questions.push({
                        type: 'pronunciation',
                        question: item.word,
                        answer: item.pinyin,
                        pinyin: item.pinyin,
                        meaning: item.meaning
                    });
                });
            }
            
            // Shuffle questions
            return shuffleArray(questions);
        }

        // Show current question
        function showQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            
            // Update progress bar and text
            const progressPercent = ((currentQuestionIndex) / quizQuestions.length) * 100;
            quizProgress.style.width = `${progressPercent}%`;
            currentProgress.textContent = currentQuestionIndex;
            
            // Set question text based on type
            if (question.type === 'dictation') {
                questionText.innerHTML = `请写出下列拼音对应的词语：<br><span style="color:#e74c3c;font-size:3.5rem;">${question.question}</span>`;
            } else {
                questionText.innerHTML = `请写出下列词语的拼音：<br><span style="font-size:4rem;">${question.question}</span>`;
            }
        }

        // Show next question or results
        function showNextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < quizQuestions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show quiz results
        function showResults() {
            // Hide quiz area, show results
            quizArea.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            
            // Clear previous results
            resultsContainer.innerHTML = '';
            
            // Add each result
            quizQuestions.forEach((question, index) => {
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                
                if (question.type === 'dictation') {
                    resultCard.innerHTML = `
                        <div class="chinese">${question.answer}</div>
                        <div class="pinyin">${question.pinyin}</div>
                        <p><strong>题目拼音：</strong> ${question.question}</p>
                        <p><strong>意思：</strong> ${question.meaning}</p>
                    `;
                } else {
                    resultCard.innerHTML = `
                        <div class="chinese">${question.question}</div>
                        <div class="pinyin">${question.pinyin}</div>
                        <p><strong>正确答案：</strong> ${question.pinyin}</p>
                        <p><strong>意思：</strong> ${question.meaning}</p>
                    `;
                }
                
                resultsContainer.appendChild(resultCard);
            });
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Initialize the application
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>