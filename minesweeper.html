<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¾®è½¯ç»å…¸æ‰«é›· - ç§»åŠ¨ç«¯å®Œç¾ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-bg: #1e1e2d;
            --board-bg: #3a3a52;
            --cell-bg: #4a4a62;
            --cell-hover: #5a5a72;
            --accent-cyan: #4cc9f0;
            --accent-pink: #f72585;
            --accent-green: #52b788;
            --text-white: #fff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            /* ç¦æ­¢ç§»åŠ¨ç«¯é•¿æŒ‰é€‰ä¸­å’Œå¼¹å‡ºèœå• */
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: var(--text-white);
            /* é˜²æ­¢ä¸‹æ‹‰åˆ·æ–°å¹²æ‰°æ¸¸æˆ */
            overscroll-behavior: none; 
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒº */
        header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--accent-cyan);
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.3);
        }

        /* æ¸¸æˆä¸»å®¹å™¨ */
        .game-wrapper {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 15px;
            width: 100%;
            max-width: 600px; /* å¹³æ¿/æ¡Œé¢é™åˆ¶æœ€å¤§å®½åº¦ */
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* æ§åˆ¶é¢æ¿ï¼ˆåˆ†æ•°ã€é‡ç½®ã€æ—¶é—´ï¼‰ */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #151520;
            padding: 10px;
            border-radius: 8px;
            border-bottom: 2px solid #333;
        }

        .counter-box {
            background: #000;
            color: var(--accent-pink);
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
        }

        .reset-btn {
            background: var(--cell-bg);
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .reset-btn:active { transform: scale(0.9); }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯æ ¸å¿ƒï¼‰ */
        .mode-toggle {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            opacity: 0.6;
            background: var(--cell-bg);
            color: #fff;
        }

        /* æ¿€æ´»çŠ¶æ€ */
        .mode-btn.active {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        
        .mode-btn.clear-active { background: var(--accent-green); color: #000; }
        .mode-btn.flag-active { background: var(--accent-pink); color: #fff; }

        /* æ£‹ç›˜å®¹å™¨ - å…³é”®ï¼šå…è®¸æ»šåŠ¨ */
        .board-scroll-container {
            width: 100%;
            overflow: auto; /* è¶…å‡ºå®½åº¦å…è®¸æ»šåŠ¨ */
            background: #252535;
            border-radius: 8px;
            padding: 10px;
            display: flex; /* è®©å†…éƒ¨æ£‹ç›˜å±…ä¸­ */
            justify-content: center;
            /* ç§»åŠ¨ç«¯æƒ¯æ€§æ»šåŠ¨ */
            -webkit-overflow-scrolling: touch; 
        }

        /* åªæœ‰åœ¨æ£‹ç›˜æ¯”å±å¹•å®½æ—¶ï¼Œæ‰é å·¦å¯¹é½ï¼Œå¦åˆ™å±…ä¸­ */
        .board-scroll-container.align-left {
            justify-content: flex-start;
        }

        .game-board {
            display: grid;
            gap: 2px;
            background: var(--board-bg);
            border: 4px solid var(--board-bg);
            /* å…³é”®ï¼šé˜²æ­¢æ£‹ç›˜è¢«æŒ¤å‹ */
            flex-shrink: 0; 
        }

        .cell {
            width: 38px; /* ç§»åŠ¨ç«¯æœ€ä½³ç‚¹å‡»å°ºå¯¸ */
            height: 38px;
            background: var(--cell-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: inset 2px 2px 0 rgba(255,255,255,0.1), inset -2px -2px 0 rgba(0,0,0,0.2);
            /* ç§»é™¤ç‚¹å‡»å»¶è¿Ÿ */
            touch-action: manipulation; 
        }

        .cell:active { background: var(--cell-hover); }
        .cell.revealed { 
            background: #2d2d3d; 
            box-shadow: none; 
            border: 1px solid #333;
        }

        /* çŠ¶æ€é¢œè‰² */
        .cell.flagged::before { content: "ğŸš©"; font-size: 1rem; }
        .cell.mine::before { content: "ğŸ’£"; font-size: 1.1rem; }
        .cell.mine.exploded { background: var(--accent-pink); }
        
        /* æ•°å­—é¢œè‰² */
        .c1 { color: #4cc9f0; } .c2 { color: #52b788; } .c3 { color: #f72585; }
        .c4 { color: #7209b7; } .c5 { color: #f77f00; } .c6 { color: #00bbf9; }
        .c7 { color: #9b5de5; } .c8 { color: #ffd166; }

        /* éš¾åº¦é€‰æ‹© */
        .difficulty-bar {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .diff-btn {
            padding: 8px 16px;
            background: var(--cell-bg);
            border: none;
            border-radius: 20px;
            color: #aaa;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
        }
        
        .diff-btn.active {
            background: var(--accent-cyan);
            color: #000;
            font-weight: bold;
        }

        /* æ¸¸æˆç»“æœæç¤º */
        #game-msg {
            text-align: center;
            height: 20px;
            font-weight: bold;
            color: var(--accent-cyan);
        }

        /* æ¡Œé¢ç«¯ä¼˜åŒ– */
        @media (min-width: 768px) {
            .game-wrapper { padding: 25px; }
            .cell { width: 30px; height: 30px; } /* æ¡Œé¢ç«¯å¯ä»¥ç”¨å°ä¸€ç‚¹çš„æ ¼å­ */
            .cell:hover { background: var(--cell-hover); }
        }
    </style>
</head>
<body>

    <header>
        <h1>æ‰«é›·</h1>
    </header>

    <div class="game-wrapper" id="game-wrapper">
        <div class="status-bar">
            <div class="counter-box" id="mines-left">010</div>
            <button class="reset-btn" id="reset-btn">ğŸ˜Š</button>
            <div class="counter-box" id="timer">000</div>
        </div>

        <div class="mode-toggle">
            <button class="mode-btn clear-active active" id="btn-mode-clear">
                <span>â›ï¸ æŒ–æ˜</span>
            </button>
            <button class="mode-btn" id="btn-mode-flag">
                <span>ğŸš© æ ‡è®°</span>
            </button>
        </div>

        <div class="board-scroll-container" id="board-container">
            <div class="game-board" id="game-board"></div>
        </div>
        
        <div id="game-msg"></div>

        <div class="difficulty-bar">
            <button class="diff-btn active" data-level="beginner">åˆçº§ (9x9)</button>
            <button class="diff-btn" data-level="intermediate">ä¸­çº§ (16x16)</button>
            <button class="diff-btn" data-level="expert">é«˜çº§ (16x30)</button>
        </div>
    </div>

<script>
    // æ¸¸æˆé…ç½®
    const LEVELS = {
        beginner: { rows: 9, cols: 9, mines: 10 },
        intermediate: { rows: 16, cols: 16, mines: 40 },
        expert: { rows: 16, cols: 30, mines: 99 }
    };

    // çŠ¶æ€ç®¡ç†
    const state = {
        grid: [],       // é€»è¾‘ç½‘æ ¼
        revealed: [],   // å·²ç¿»å¼€çŠ¶æ€
        flagged: [],    // æ ‡è®°çŠ¶æ€
        minesLoc: [],   // åœ°é›·ä½ç½®
        status: 'ready', // ready, playing, lost, won
        level: 'beginner',
        minesLeft: 10,
        timer: 0,
        timerId: null,
        mode: 'clear'   // 'clear' æˆ– 'flag' (ç§»åŠ¨ç«¯æ¨¡å¼)
    };

    // DOM å…ƒç´ 
    const dom = {
        board: document.getElementById('game-board'),
        container: document.getElementById('board-container'),
        minesLeft: document.getElementById('mines-left'),
        timer: document.getElementById('timer'),
        resetBtn: document.getElementById('reset-btn'),
        msg: document.getElementById('game-msg'),
        modeClear: document.getElementById('btn-mode-clear'),
        modeFlag: document.getElementById('btn-mode-flag'),
        wrapper: document.getElementById('game-wrapper')
    };

    // åˆå§‹åŒ–
    function initGame(levelKey) {
        // æ¸…ç†æ—§çŠ¶æ€
        clearInterval(state.timerId);
        state.status = 'ready';
        state.timer = 0;
        state.level = levelKey || state.level;
        const config = LEVELS[state.level];
        
        state.minesLeft = config.mines;
        state.grid = Array(config.rows).fill().map(() => Array(config.cols).fill(0));
        state.revealed = Array(config.rows).fill().map(() => Array(config.cols).fill(false));
        state.flagged = Array(config.rows).fill().map(() => Array(config.cols).fill(false));
        state.minesLoc = [];

        // UI é‡ç½®
        dom.minesLeft.textContent = String(state.minesLeft).padStart(3, '0');
        dom.timer.textContent = '000';
        dom.resetBtn.textContent = 'ğŸ˜Š';
        dom.msg.textContent = '';
        
        // æ¸²æŸ“ç½‘æ ¼
        renderBoard(config.rows, config.cols);
        
        // è‡ªåŠ¨å¯¹é½å¤„ç†ï¼ˆå¦‚æœæ£‹ç›˜æ¯”å±å¹•å®½ï¼Œé å·¦å¯¹é½æ–¹ä¾¿æ»šåŠ¨ï¼‰
        setTimeout(() => {
            if (dom.board.offsetWidth > dom.container.offsetWidth) {
                dom.container.classList.add('align-left');
            } else {
                dom.container.classList.remove('align-left');
            }
        }, 50);
    }

    // æ¸²æŸ“æ£‹ç›˜ HTML
    function renderBoard(rows, cols) {
        dom.board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        dom.board.innerHTML = '';

        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.r = r;
                cell.dataset.c = c;
                
                // æ ¸å¿ƒäº¤äº’äº‹ä»¶
                cell.addEventListener('click', (e) => handleInteraction(r, c));
                cell.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    toggleFlag(r, c); // æ¡Œé¢ç«¯å³é”®æ ‡è®°
                });
                
                // åŒå‡»è‡ªåŠ¨å¼€å‘¨å›´ï¼ˆPCç«¯ä¹ æƒ¯ï¼‰
                cell.addEventListener('dblclick', () => quickClear(r, c));
                
                dom.board.appendChild(cell);
            }
        }
    }

    // å¤„ç†ç‚¹å‡»äº¤äº’ (ç»Ÿä¸€å¤„ç†é¼ æ ‡å’Œè§¦æ‘¸)
    function handleInteraction(r, c) {
        if (state.status === 'lost' || state.status === 'won') return;

        // å¦‚æœæ˜¯æ ‡è®°æ¨¡å¼ï¼Œåˆ™æ‰§è¡Œæ ‡è®°é€»è¾‘
        if (state.mode === 'flag') {
            toggleFlag(r, c);
            return;
        }

        // å¦‚æœå·²ç»æ ‡è®°äº†ï¼Œç‚¹å‡»æ— æ•ˆï¼ˆé˜²æ­¢è¯¯è§¦ï¼‰
        if (state.flagged[r][c]) return;

        // æŒ–æ˜é€»è¾‘
        revealCell(r, c);
    }

    // æ”¾ç½®åœ°é›·ï¼ˆç¬¬ä¸€æ¬¡ç‚¹å‡»åç”Ÿæˆï¼Œä¿è¯ç¬¬ä¸€ä¸‹ä¸æ­»ï¼‰
    function placeMines(safeR, safeC) {
        const config = LEVELS[state.level];
        let placed = 0;
        while (placed < config.mines) {
            const r = Math.floor(Math.random() * config.rows);
            const c = Math.floor(Math.random() * config.cols);
            
            // é¿å¼€ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®åŠå…¶å‘¨å›´
            if (Math.abs(r - safeR) <= 1 && Math.abs(c - safeC) <= 1) continue;
            
            if (state.grid[r][c] !== 'M') {
                state.grid[r][c] = 'M';
                state.minesLoc.push({r, c});
                updateNeighbors(r, c, config.rows, config.cols);
                placed++;
            }
        }
    }

    // æ›´æ–°å‘¨å›´æ•°å­—
    function updateNeighbors(r, c, maxR, maxC) {
        for (let i = r-1; i <= r+1; i++) {
            for (let j = c-1; j <= c+1; j++) {
                if (i >= 0 && i < maxR && j >= 0 && j < maxC && state.grid[i][j] !== 'M') {
                    state.grid[i][j]++;
                }
            }
        }
    }

    // ç¿»å¼€æ ¼å­
    function revealCell(r, c) {
        // é¦–æ¬¡ç‚¹å‡»åˆå§‹åŒ–
        if (state.status === 'ready') {
            state.status = 'playing';
            startTimer();
            placeMines(r, c);
        }

        if (state.revealed[r][c] || state.flagged[r][c]) return;

        const cell = getCellDom(r, c);
        state.revealed[r][c] = true;
        cell.classList.add('revealed');

        const val = state.grid[r][c];

        if (val === 'M') {
            // è¸©é›·
            gameOver(false);
            cell.classList.add('mine', 'exploded');
        } else if (val === 0) {
            // ç©ºç™½æ ¼ï¼Œé€’å½’ç¿»å¼€
            const config = LEVELS[state.level];
            for (let i = r-1; i <= r+1; i++) {
                for (let j = c-1; j <= c+1; j++) {
                    if (i >= 0 && i < config.rows && j >= 0 && j < config.cols) {
                        revealCell(i, j);
                    }
                }
            }
        } else {
            // æ•°å­—æ ¼
            cell.textContent = val;
            cell.classList.add('c' + val);
        }

        checkWin();
    }

    // åˆ‡æ¢æ ‡è®°
    function toggleFlag(r, c) {
        if (state.revealed[r][c] || state.status === 'lost' || state.status === 'won') return;

        const cell = getCellDom(r, c);
        state.flagged[r][c] = !state.flagged[r][c];
        
        if (state.flagged[r][c]) {
            cell.classList.add('flagged');
            state.minesLeft--;
            // éœ‡åŠ¨åé¦ˆ (Android)
            if (navigator.vibrate) navigator.vibrate(50);
        } else {
            cell.classList.remove('flagged');
            state.minesLeft++;
        }
        dom.minesLeft.textContent = String(state.minesLeft).padStart(3, '0');
    }

    // å¿«é€Ÿå¼€å‘¨å›´ï¼ˆåŒå‡»æˆ–å·²ç¿»å¼€æ•°å­—ç‚¹å‡»ï¼‰
    function quickClear(r, c) {
        if (!state.revealed[r][c]) return;
        
        const val = state.grid[r][c];
        if (val === 0) return;

        // è®¡ç®—å‘¨å›´æ——å¸œæ•°
        const config = LEVELS[state.level];
        let flags = 0;
        for (let i = r-1; i <= r+1; i++) {
            for (let j = c-1; j <= c+1; j++) {
                if (i >= 0 && i < config.rows && j >= 0 && j < config.cols) {
                    if (state.flagged[i][j]) flags++;
                }
            }
        }

        // æ——å¸œæ•°å¯¹ç­‰ï¼Œç¿»å¼€å‘¨å›´
        if (flags === val) {
            for (let i = r-1; i <= r+1; i++) {
                for (let j = c-1; j <= c+1; j++) {
                    if (i >= 0 && i < config.rows && j >= 0 && j < config.cols) {
                        if (!state.revealed[i][j] && !state.flagged[i][j]) {
                            revealCell(i, j);
                        }
                    }
                }
            }
        }
    }

    function getCellDom(r, c) {
        return document.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);
    }

    function startTimer() {
        state.timerId = setInterval(() => {
            state.timer++;
            dom.timer.textContent = String(Math.min(state.timer, 999)).padStart(3, '0');
        }, 1000);
    }

    function gameOver(win) {
        clearInterval(state.timerId);
        state.status = win ? 'won' : 'lost';
        dom.resetBtn.textContent = win ? 'ğŸ˜' : 'ğŸ˜µ';
        dom.msg.textContent = win ? 'æ­å–œé€šå…³ï¼' : 'æ¸¸æˆç»“æŸ';
        
        // è¾¹æ¡†å˜è‰²åé¦ˆ
        dom.wrapper.style.borderColor = win ? '#52b788' : '#f72585';

        // è¾“äº†æ˜¾ç¤ºæ‰€æœ‰é›·
        if (!win) {
            state.minesLoc.forEach(loc => {
                if (!state.flagged[loc.r][loc.c]) {
                    const cell = getCellDom(loc.r, loc.c);
                    cell.classList.add('mine', 'revealed');
                }
            });
            // æ ‡è®°é”™äº†çš„æ˜¾ç¤ºä¸ªå‰ï¼ˆè¿™é‡Œç®€åŒ–ä¸ºä¸å¤„ç†æˆ–ä¿ç•™æ——å­ï¼‰
        }
    }

    function checkWin() {
        if (state.status !== 'playing') return;
        const config = LEVELS[state.level];
        const totalCells = config.rows * config.cols;
        let revealedCount = 0;

        for (let r = 0; r < config.rows; r++) {
            for (let c = 0; c < config.cols; c++) {
                if (state.revealed[r][c]) revealedCount++;
            }
        }

        if (revealedCount === totalCells - config.mines) {
            gameOver(true);
        }
    }

    // --- äº‹ä»¶ç›‘å¬ç»‘å®š ---

    // éš¾åº¦æŒ‰é’®
    document.querySelectorAll('.diff-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            initGame(btn.dataset.level);
        });
    });

    // é‡ç½®æŒ‰é’®
    dom.resetBtn.addEventListener('click', () => initGame());

    // æ¨¡å¼åˆ‡æ¢é€»è¾‘
    function setMode(mode) {
        state.mode = mode;
        if (mode === 'clear') {
            dom.modeClear.classList.add('active', 'clear-active');
            dom.modeFlag.classList.remove('active', 'flag-active');
            dom.wrapper.style.border = 'none'; // ç§»é™¤ä¹‹å‰çš„è¾¹æ¡†è‰²
        } else {
            dom.modeFlag.classList.add('active', 'flag-active');
            dom.modeClear.classList.remove('active', 'clear-active');
        }
    }

    dom.modeClear.addEventListener('click', () => setMode('clear'));
    dom.modeFlag.addEventListener('click', () => setMode('flag'));

    // å¯åŠ¨æ¸¸æˆ
    initGame('beginner');

</script>
</body>
</html>
